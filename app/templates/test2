//2層 圖層 版本 沒有剪取
<html>
<head></head>
<body bgcolor="#fff">
<canvas width="300" height="227" id="myCanvas2" style="border:1px solid;position:absolute;top:100;left:100;"></canvas>  <!--first law picture-->
<canvas width="300" height="227" id="myCanvas" style="border:1px solid;position:absolute;top:100;left:100;"></canvas>   <!--second law-->
<input type="button" id="save" value="在新視窗開啟圖片">

<div id="color" style="width:200px;height:50px;float:left"></div>

{% load staticfiles %}

<script>
var canvas = document.getElementById("myCanvas"); // 取得物件
var ctx = canvas.getContext("2d"); // 取得繪圖環境
var drawMode, mx, my;


var img = new Image();
img.src = "{% static 'img/test.jpg' %}";  //load img
var canvas2 = document.getElementById("myCanvas2"); // 取得物件
var ctx2 = canvas.getContext("2d"); // 取得繪圖環境 圖片
img.onload = function() {
  ctx2.drawImage(img, 0, 0);
  img.style.display = 'none';
};


var color = document.getElementById('color');
function pick(event) {
  var x = event.layerX;
  var y = event.layerY;
  var pixel = ctx2.getImageData(x, y, 1, 1);
  var data = pixel.data;
  var rgba = 'rgba(' + data[0] + ',' + data[1] +
             ',' + data[2] + ',' + data[3] + ')';
  color.style.background =  rgba;
  color.textContent = rgba;
}
canvas.addEventListener('mousemove', pick);



canvas.onmousedown = function(ev){
    ctx.beginPath();
    ctx.strokeStyle = "#00f";
    ctx.lineWidth = 1;
    mx = event.clientX - parseInt(canvas.style.left) + window.pageXOffset;
    my = event.clientY - parseInt(canvas.style.top) + window.pageYOffset;
    ctx.moveTo(mx, my);
    drawMode = true;
}

canvas.onmousemove = function(ev){
    if(drawMode){
        mx = event.clientX - parseInt(canvas.style.left) + window.pageXOffset;
        my = event.clientY - parseInt(canvas.style.top) + window.pageYOffset;
        ctx.lineTo(mx, my);
        ctx.stroke();
    }
}

canvas.onmouseup = function(){
  ctx.closePath();//結束時自動連回beginpath
  ctx.fill();  //結束時自動填滿封閉路徑


    drawMode = false;
}

document.getElementById("save").onclick = function(){
      ctx.globalCompositeOperation="destination-in";
    window.open(ctx.canvas.toDataURL('img/png'));
}
</script>

</body></html>
